const e="2.11.0",t=e=>{const t=((e="")=>e.replace(/\/$/u,""))(e);return/^(https?:)?\/\//.test(t)?t:`https://${t}`},n=e=>{"AbortError"!==e.name&&console.error(e.message)},r={"Content-Type":"application/json"},a=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: ${e.errmsg}`);return e},o=({serverURL:e,lang:t,paths:n,signal:r})=>(({serverURL:e,lang:t,paths:n,type:r,signal:o})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(r.join(","))}&lang=${t}`,{signal:o}).then((e=>e.json())).then((e=>a(e,"article count"))))({serverURL:e,lang:t,paths:n,type:["time"],signal:r}).then((e=>Array.isArray(e)?e:[e])),l=e=>(({serverURL:e,lang:t,path:n,type:o,action:l})=>fetch(`${e}/article?lang=${t}`,{method:"POST",headers:r,body:JSON.stringify({path:n,type:o,action:l})}).then((e=>e.json())).then((e=>a(e,"article count"))))({...e,type:"time"}),s=e=>e.dataset.path||e.getAttribute("id"),i=(e,t)=>{t.forEach(((t,n)=>{t.innerText=e[n].toString()}))},h=({serverURL:e,path:r=window.location.pathname,selector:a=".waline-pageview-count",update:h=!0,lang:p="zh-CN"})=>{const c=new AbortController,g=Array.from(document.querySelectorAll(a)),y=e=>{const t=s(e);return null!==t&&r!==t},u=a=>o({serverURL:t(e),paths:a.map((e=>s(e)||r)),lang:p,signal:c.signal}).then((e=>i(e,a))).catch(n);if(h){const n=g.filter((e=>!y(e))),a=g.filter(y);l({serverURL:t(e),path:r,lang:p}).then((e=>i(new Array(n.length).fill(e),n))),a.length&&u(a)}else u(g);return c.abort.bind(c)};export{h as pageviewCount,e as version};
//# sourceMappingURL=pageview.mjs.map
